"use strict";!function(){var o,r,c,d,s,u,l,p,m,v,h;"undefined"!=typeof wp&&(o=wp.i18n.__,null!==(r=document.querySelector("#social-planner-metabox > .inside"))&&void 0!==window.socialPlannerMetabox&&(c=window.socialPlannerMetabox,d=function(e,t){var n=document.createElement("p");for(n.classList.add("social-planner-warning"),n.textContent=t;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(n)},s=function(e,t){var n=function(e){e=e||Date.now(),c.offset=parseInt(c.offset)||0;var t=(new Date).getTimezoneOffset(),t=Date.now()+60*t*1e3;return e=new Date(t+1e3*c.offset),new Date(e)}(),a={hour:("0"+n.getHours()).slice(-2),minute:("0"+n.getMinutes()).slice(-2)},n=c.meta+"["+t+"]",i=document.createElement("input");i.setAttribute("type","text"),i.setAttribute("name",n+"[hour]"),i.value=a.hour,e.appendChild(i),i.addEventListener("change",function(){return i.value.match(/^\d+$/)?(i.value=("0"+parseInt(i.value)).slice(-2),23<i.value||i.value<0?i.value=a.hour:void(a.hour=i.value)):i.value=a.hour});t=document.createElement("span");t.textContent=":",e.appendChild(t);var l=document.createElement("input");l.setAttribute("type","text"),l.setAttribute("name",n+"[minute]"),l.value=a.minute,e.appendChild(l),l.addEventListener("change",function(){return l.value.match(/^\d+$/)?(l.value=("0"+l.value).slice(-2),59<l.value||l.value<0?l.value=a.minute:void(a.minute=l.value)):l.value=a.minute})},u=function(e,t,n){var a=document.createElement("option");return a.textContent=t,a.value=n||"",e.appendChild(a),a},l=function(e,t,n){var a=document.createElement("div");a.classList.add("social-planner-snippet"),e.appendChild(a);var i=c.meta+"["+t+"]",e=document.createElement("textarea");e.classList.add("social-planner-excerpt"),e.setAttribute("placeholder",o("Social networks summary","social-planner")),e.setAttribute("name",i+"[excerpt]"),n.excerpt&&(e.textContent=n.excerpt),a.appendChild(e),function(e,t,n){if(wp.media){var a=document.createElement("figure");a.classList.add("social-planner-poster"),e.appendChild(a);var t=c.meta+"["+t+"]",i=document.createElement("button");i.classList.add("choose"),i.setAttribute("type","button"),i.textContent="+",a.appendChild(i);var l=document.createElement("img"),r=document.createElement("input");r.setAttribute("type","hidden"),r.setAttribute("name",t+"[attachment]"),n.attachment&&(r.value=n.attachment),a.appendChild(r);var d=document.createElement("input");d.setAttribute("type","hidden"),d.setAttribute("name",t+"[thumbnail]"),n.thumbnail&&(d.value=n.thumbnail,l.setAttribute("src",n.thumbnail),a.insertBefore(l,i)),a.appendChild(d),i.addEventListener("click",function(){var n=wp.media({title:o("Choose poster image","social-planner"),multiple:!1});n.on("select",function(){var e=n.state().get("selection").first().toJSON(),t=e.url;r.value=e.id,void 0!==e.sizes.thumbnail&&(t=e.sizes.thumbnail.url),d.value=t,l.setAttribute("src",t),l.parentNode||a.insertBefore(l,i)}),n.open()});n=document.createElement("button");n.classList.add("remove"),n.setAttribute("type","button"),a.appendChild(n),n.addEventListener("click",function(e){e.stopPropagation(),r.value="",d.value="",a.removeChild(l)})}}(a,t,n)},p=function(e,t,n){var a=document.createElement("div");if(a.classList.add("social-planner-scheduler"),e.appendChild(a),n.scheduled)return function(a,i,l){var e=document.createElement("span");e.classList.add("social-planner-clock"),a.appendChild(e);e=document.createElement("span");e.textContent=o("Scheduled for:","social-planner"),a.appendChild(e);e=document.createElement("strong");if(e.textContent=l.scheduled,a.appendChild(e),!window.FormData)return d(a,o("Your browser does not support the FormData feature.","social-planner"));e=document.createElement("button");e.classList.add("button-link"),e.textContent=o("Cancel","social-planner"),e.addEventListener("click",function(e){if(e.preventDefault(),!c.action||!c.nonce)return d(a,o("Incorrect configuration of metbox options.","social-planner"));var t=document.getElementById("post_ID");if(null===t)return d(a,o("Post ID element is not defined.","social-planner"));e=document.createElement("span");e.classList.add("spinner","is-active"),a.appendChild(e);e=new window.FormData;e.append("handler","cancel"),e.append("action",c.action),e.append("nonce",c.nonce),e.append("post",t.value),e.append("key",i);var n=new XMLHttpRequest;n.open("POST",ajaxurl),n.onerror=function(){return d(a,o("Something wrong with request.","social-planner"))},n.onload=function(){JSON.parse(n.response);delete l.scheduled,a.innerHTML="",p(a.parentNode,i,l)},n.send(e)}),a.appendChild(e)}(a,t,n);var n=c.meta+"["+t+"]",i=document.createElement("select");i.setAttribute("name",n+"[date]"),a.appendChild(i);var l,r=document.createElement("div");for(l in r.classList.add("social-planner-time"),a.appendChild(r),u(i,o("Do not send automatically","social-planner")),u(i,o("Publish immediately","social-planner"),"now"),c.calendar=c.calendar||{},c.calendar)u(i,c.calendar[l],l);i.addEventListener("change",function(){for(;r.firstChild;)r.removeChild(r.firstChild);i.value&&"now"!==i.value&&s(r,t)})},m=function(e,t,n){var a=document.createElement("div");a.classList.add("social-planner-targets"),e.appendChild(a),c.errors||c.sent||function(e,t,n){for(var a in c.providers){var i,l,r,d=c.providers[a];d.label&&((i=document.createElement("label")).classList.add("social-planner-check"),e.append(i),l=c.meta+"["+t+"]",(r=document.createElement("input")).setAttribute("type","checkbox"),r.setAttribute("name",l+"[targets][]"),r.value=a,(l=n.targets||[])&&-1<l.indexOf(a)&&r.setAttribute("checked","checked"),i.appendChild(r),(r=document.createElement("span")).textContent=d.label,i.appendChild(r))}}(a,t,n)},v=function(e){var t=(new Date).getTime().toString(36);h(e,t)},h=function(e,t,n){var a=document.createElement("fieldset");a.classList.add("social-planner-task"),e.appendChild(a),m(a,t,n=n||{});var i=document.createElement("button");i.classList.add("social-planner-remove"),i.setAttribute("type","button"),a.appendChild(i),i.addEventListener("click",function(){e.removeChild(a),e.hasChildNodes()||v(e)}),l(a,t,n),function(e,t,n){var a=document.createElement("label");a.classList.add("social-planner-preview"),e.appendChild(a);e=c.meta+"["+t+"]",t=document.createElement("input");t.setAttribute("type","checkbox"),t.setAttribute("name",e+"[preview]"),t.value=1,n.preview&&t.setAttribute("checked","checked"),a.appendChild(t);t=document.createElement("span");t.textContent=o("Do not generate preview","social-planner"),a.appendChild(t)}(a,t,n),p(a,t,n)},function(){var e,t,n=document.createElement("div");if(n.classList.add("social-planner-list"),r.appendChild(n),!c.meta||!c.providers)return d(r,o("You need to configure providers on the plugin settings page.","social-planner"));c.tasks=c.tasks||{},e=n,(t=document.createElement("button")).classList.add("social-planner-append","button"),t.setAttribute("type","button"),t.textContent=o("Add task","social-planner"),t.addEventListener("click",function(){v(e)}),r.appendChild(t);var a,i=c.schedules||{};for(a in c.tasks){var l=c.tasks[a];i[a]&&(l.scheduled=i[a]),h(n,a,l)}n.hasChildNodes()||v(n)}()))}();