"use strict";!function(){var p,n,m,s,l,d,o,r,i,c,u,v,h,a,f,C,b;"undefined"!=typeof wp&&(p=wp.i18n.__,null!==(n=document.querySelector("#social-planner-metabox > .inside"))&&void 0!==window.socialPlannerMetabox&&(m=window.socialPlannerMetabox||{},s=function(e,t){var n=document.createElement("p");for(n.classList.add("social-planner-warning"),n.textContent=t;e.firstChild;)e.removeChild(e.lastChild);e.appendChild(n)},l=function(t,e,n){if(!m.action||!m.nonce)return s(t,p("Incorrect configuration of metbox options.","social-planner"));var a=document.getElementById("post_ID");if(null===a)return s(t,p("Post ID element is not defined.","social-planner"));var l,r=new window.FormData;for(l in r.append("action",m.action),r.append("nonce",m.nonce),r.append("post",a.value),e)r.append(l,e[l]);var i=new XMLHttpRequest;i.open("POST",ajaxurl),i.onerror=function(){return s(t,p("Something went wrong. Try to reload page.","social-planner"))},i.onload=function(){var e=JSON.parse(i.responseText);if(!e.success)return s(t,p("Something went wrong. Try to reload page.","social-planner"));"function"==typeof n&&n(e)},i.send(r)},d=function(e,t){var n=function(e){e=e||Date.now(),m.offset=parseInt(m.offset)||0;var t=(new Date).getTimezoneOffset(),t=Date.now()+60*t*1e3;return e=new Date(t+1e3*m.offset),new Date(e)}(),a={hour:("0"+n.getHours()).slice(-2),minute:("0"+n.getMinutes()).slice(-2)},n=m.meta+"["+t+"]",l=document.createElement("input");l.setAttribute("type","text"),l.setAttribute("name",n+"[hour]"),l.value=a.hour,e.appendChild(l),l.addEventListener("change",function(){return l.value.match(/^\d+$/)?(l.value=("0"+parseInt(l.value)).slice(-2),23<l.value||l.value<0?l.value=a.hour:void(a.hour=l.value)):l.value=a.hour});t=document.createElement("span");t.textContent=":",e.appendChild(t);var r=document.createElement("input");r.setAttribute("type","text"),r.setAttribute("name",n+"[minute]"),r.value=a.minute,e.appendChild(r),r.addEventListener("change",function(){return r.value.match(/^\d+$/)?(r.value=("0"+r.value).slice(-2),59<r.value||r.value<0?r.value=a.minute:void(a.minute=r.value)):r.value=a.minute})},o=function(e,t,n){var a=document.createElement("option");return a.textContent=t,a.value=n||"",e.appendChild(a),a},r=function(e,t,n){var a=document.createElement("div");a.classList.add("social-planner-snippet"),e.appendChild(a);var l=m.meta+"["+t+"]",e=document.createElement("textarea");e.classList.add("social-planner-excerpt"),e.setAttribute("placeholder",p("Social networks summary","social-planner")),e.setAttribute("name",l+"[excerpt]"),n.result.sent&&e.setAttribute("readonly","readonly"),n.schedule&&e.setAttribute("readonly","readonly"),n.task.excerpt&&(e.textContent=n.task.excerpt),a.appendChild(e),function(e,t,n){if(wp.media){var a=document.createElement("figure");a.classList.add("social-planner-poster"),e.appendChild(a);var t=m.meta+"["+t+"]",l=document.createElement("button");l.classList.add("choose"),l.setAttribute("type","button"),l.textContent="+",n.result.sent||n.schedule||a.appendChild(l);var r=document.createElement("img"),i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name",t+"[attachment]"),n.task.attachment&&(i.value=n.task.attachment),a.appendChild(i);var s=document.createElement("input");s.setAttribute("type","hidden"),s.setAttribute("name",t+"[thumbnail]"),n.task.thumbnail&&(s.value=n.task.thumbnail,r.setAttribute("src",n.task.thumbnail),a.appendChild(r)),a.appendChild(s),l.addEventListener("click",function(){var n=wp.media({title:p("Choose poster image","social-planner"),multiple:!1});n.on("select",function(){var e=n.state().get("selection").first().toJSON(),t=e.url;i.value=e.id,void 0!==e.sizes.thumbnail&&(t=e.sizes.thumbnail.url),s.value=t,r.setAttribute("src",t),r.parentNode||a.insertBefore(r,l)}),n.open()});t=document.createElement("button");t.classList.add("remove"),t.setAttribute("type","button"),n.result.sent||n.schedule||a.appendChild(t),t.addEventListener("click",function(e){e.stopPropagation(),i.value="",s.value="",a.removeChild(r)})}}(a,t,n)},i=function(e){delete m.tasks[e],C()},c=function(e,t,n){var a=document.createElement("span");a.classList.add("spinner","is-active"),e.appendChild(a),l(e,{handler:"cancel",key:t},n)},u=function(e,t,n){var a=document.createElement("div");if(a.classList.add("social-planner-scheduler"),e.appendChild(a),n.result.sent)return function(e,t){var n=document.createElement("span");n.classList.add("social-planner-calendar"),e.appendChild(n);n=document.createElement("span");n.textContent=p("Sent:","social-planner"),e.appendChild(n);n=document.createElement("strong");n.textContent=t.result.sent,e.appendChild(n)}(a,n);if(n.schedule)return function(t,n,e){var a=document.createElement("span");a.classList.add("social-planner-clock"),t.appendChild(a);a=document.createElement("span");a.textContent=p("Scheduled for:","social-planner"),t.appendChild(a);a=document.createElement("strong");a.textContent=e.schedule,t.appendChild(a);a=document.createElement("button");a.classList.add("button-link"),a.textContent=p("Cancel","social-planner"),a.addEventListener("click",function(e){e.preventDefault(),c(t,n,function(){delete m.schedules[n],C()})}),t.appendChild(a)}(a,t,n);var n=m.meta+"["+t+"]",l=document.createElement("select");l.setAttribute("name",n+"[date]"),a.appendChild(l);var r,i=document.createElement("div");for(r in i.classList.add("social-planner-time"),a.appendChild(i),o(l,p("Do not send automatically","social-planner")),o(l,p("Publish immediately","social-planner"),"now"),m.calendar=m.calendar||{},m.calendar)o(l,m.calendar[r],r);l.addEventListener("change",function(){for(;i.firstChild;)i.removeChild(i.lastChild);l.value&&"now"!==l.value&&d(i,t)})},v=function(e,t,n){for(var a,l,r,i=n.task.targets||[],s=0;s<i.length;s++){var d,o,c,u=i[s];m.providers[u]&&((d=m.providers[u]).label&&((o=document.createElement("input")).value=u,o.setAttribute("type","hidden"),o.setAttribute("name",t+"[targets][]"),e.appendChild(o),n.result.links&&n.result.links[u]?"http"===(c=n.result.links[u]).substring(0,4)?(a=e,l=c,r=d,o=void 0,(o=document.createElement("a")).classList.add("social-planner-link"),o.textContent=r.label,o.setAttribute("href",l),o.setAttribute("target","_blank"),o.setAttribute("rel","noopener"),a.appendChild(o)):function(n,a,e){var t=document.createElement("button");t.classList.add("social-planner-info"),t.textContent=e.label,t.setAttribute("type","button"),t.addEventListener("click",function(e){e.preventDefault();var t=n.querySelector(".social-planner-extended");if(null!==t)return n.removeChild(t);e="<strong>"+p("Sent message:","social-planner")+"</strong>";(t=document.createElement("p")).classList.add("social-planner-extended"),t.textContent=a,t.innerHTML=e+a,n.appendChild(t)}),n.appendChild(t)}(e,c,d):(c=p("The reason for this error is unknown","social-planner"),n.result.errors&&n.result.errors[u]&&(c=n.result.errors[u]),function(n,a,e){var t=document.createElement("button");t.classList.add("social-planner-error"),t.textContent=e.label,t.addEventListener("click",function(e){e.preventDefault();var t=n.querySelector(".social-planner-extended");if(null!==t)return n.removeChild(t);e="<strong>"+p("Sent error:","social-planner")+"</strong>";(t=document.createElement("p")).classList.add("social-planner-extended"),t.textContent=a,t.innerHTML=e+t.textContent,n.appendChild(t)}),n.appendChild(t)}(e,c,d))))}},h=function(e,t,n){var a,l=n.task.targets||[];for(a in m.providers){var r,i=m.providers[a];i.label&&(n.schedule?0<=l.indexOf(a)&&((r=function(e,t){var n=document.createElement("label");n.classList.add("social-planner-scheduled"),e.appendChild(n);var a=document.createElement("input");a.setAttribute("type","hidden"),n.appendChild(a);e=document.createElement("span");return e.textContent=t.label,n.appendChild(e),a}(e,i)).setAttribute("name",t+"[targets][]"),r.value=a):((i=function(e,t){var n=document.createElement("label");n.classList.add("social-planner-checkbox"),e.appendChild(n);var a=document.createElement("input");a.setAttribute("type","checkbox"),n.appendChild(a);e=document.createElement("span");return e.textContent=t.label,n.appendChild(e),a}(e,i)).setAttribute("name",t+"[targets][]"),i.value=a,0<=l.indexOf(a)&&i.setAttribute("checked","checked")))}},a=function(e){var t=(new Date).getTime().toString(36);f(e,t)},f=function(e,t){var n={},a=document.createElement("fieldset");a.classList.add("social-planner-task"),e.appendChild(a),n.task={},m.tasks&&m.tasks[t]&&(n.task=m.tasks[t]),n.result={},m.results&&m.results[t]&&(n.result=m.results[t]),n.schedule=null,m.schedules&&m.schedules[t]&&(n.schedule=m.schedules[t]),function(e,t,n){var a=document.createElement("div");a.classList.add("social-planner-targets"),e.appendChild(a);t=m.meta+"["+t+"]";(n.result.sent?v:h)(a,t,n)}(a,t,n);e=document.createElement("button");e.classList.add("social-planner-remove"),e.setAttribute("type","button"),a.appendChild(e),e.addEventListener("click",function(){if(!n.schedule)return i(t);var e=a.querySelector(".social-planner-scheduler");c(e,t,function(){return i(t)})}),r(a,t,n),function(e,t,n){var a=document.createElement("label");a.classList.add("social-planner-preview"),e.appendChild(a);e=m.meta+"["+t+"]",t=document.createElement("input");t.setAttribute("name",e+"[preview]"),t.value=1,a.appendChild(t);e=document.createElement("span");if(a.appendChild(e),n.result.sent||n.schedule)return t.setAttribute("type","hidden"),e.textContent=p("Preview disabled","social-planner"),n.task.preview||(t.value=0,e.textContent=p("Preview enabled","social-planner"));t.setAttribute("type","checkbox"),n.task.preview&&t.setAttribute("checked","checked"),e.textContent=p("Disable preview","social-planner")}(a,t,n),u(a,t,n)},C=function(){var e,t=n.querySelector(".social-planner-list");for(null===t&&((t=document.createElement("div")).classList.add("social-planner-list"),n.appendChild(t));t.firstChild;)t.removeChild(t.lastChild);for(e in m.tasks=m.tasks||{},m.tasks)f(t,e);return t.hasChildNodes()||a(t),t},b=function(){var t=wp.data.select("core/edit-post").isSavingMetaBoxes();wp.data.subscribe(function(){var e=wp.data.select("core/edit-post").isSavingMetaBoxes();t&&!e&&l(parent,{handler:"update"},function(e){m=e.data||{},C()}),t=e})},function(){if(!m.meta||!m.providers)return s(n,p("Need to configure the plugin on the settings page.","social-planner"));var e,t=C();e=t,(t=document.createElement("button")).classList.add("social-planner-append","button"),t.setAttribute("type","button"),t.textContent=p("Add task","social-planner"),t.addEventListener("click",function(){a(e)}),n.appendChild(t),b()}()))}();